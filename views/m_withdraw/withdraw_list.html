{% extends "../layout/mbase.html" %}

{% block css %}{% end %}

{% block js %}
<script>
    //---------------提现--------------------------
    $(function () {
        $('table tr .btn-sm').click(function () {
            if (confirm("确定已支付吗？")) {
                $.post('/m/withDraw/' + $(this).data('wid'), function (res) {
                    if (res.status == 1) {
                        window.location.reload();
                    }
                }, 'json');
            }

            return false;
        });
    });
</script>

<script>
    $(function () {
        $('.withdrawsearch').click(function () {
            var keyword = $.trim($('.withdrawkeyword').val());
            if (keyword != '') {
                var data = {'keyword': keyword};
                $.post('/m/withdraw/searchlist', data, function (res) {
                    $('#searchcontent').empty();
                    $('#searchcontent').html(res);
                }, 'html');
            } else {
                alert('搜索框为空，请先填写，再搜索');
                return;
            }
        });
    });


</script>
{% end %}
{% block nav %}
{% module Template("module/backnav.html", name='withdraw') %}
{% end %}
{% block container%}

<div class="container">
    <!--<a href="#" class="btn btn-primary pull-right btn-sm layout-mt20">添加</a>-->

    <h3>提现
        <small>列表</small>
    </h3>
    <hr/>

    <div class="row">
        <div class="col-xs-3">
            <div class="input-group layout-mt20">
                <input type="text" class="form-control withdrawkeyword" placeholder="输入名称搜索">
                <span class="input-group-btn"> <a class="btn btn-default withdrawsearch"> 搜索 </a> </span>
            </div>
            <div class="list-group layout-mt20">
                <a href="/m/withdraw/list/0" class="list-group-item {{'active' if typ==0 else ''}}">玩家提现中</a>
                <a href="/m/withdraw/list/1" class="list-group-item {{'active' if typ==1 else ''}}">玩家已提现</a>
                <a href="/m/withdraw/list/2" class="list-group-item {{'active' if typ==2 else ''}}">代理提现中</a>
                <a href="/m/withdraw/list/3" class="list-group-item {{'active' if typ==3 else ''}}">代理已提现</a>
            </div>
        </div>

        <div class="col-xs-9" id="searchcontent">
            <table class="table table-hover layout-mt20">
                <thead>
                {%if typ in[0,1]%}
                <tr>
                    <th>编号</th>
                    <th>姓名</th>
                    <th>金额</th>
                    <th>支付宝</th>
                    <th>手机</th>
                    <th>状态</th>
                    {%if typ in [0,2]%}
                    <th>提现时间</th>
                    <th>操作</th>
                    {%elif typ in [1,3]%}
                    <th>支付时间</th>
                    {%end%}
                </tr>
                {%elif typ in [2,3]%}
                <tr>
                    <th>编号</th>
                    <th>姓名</th>
                    <th>金额</th>
                    <th>联运方</th>
                    <th>手机</th>
                    <th>状态</th>
                    {%if typ in [0,2]%}
                    <th>提现时间</th>
                    <th>操作</th>
                    {%elif typ in [1,3]%}
                    <th>支付时间</th>
                    {%end%}
                </tr>
                {%end%}
                </thead>
                <tbody>
                {% for withdraw in withdrawList%}
                {%if typ in[0,1]%}
                <tr>
                    <td>{{700000+withdraw.user.id}}</td>
                    <td>{{withdraw.user.real_name}}</td>
                    <td>{{withdraw.amount}}</td>
                    <td>{{withdraw.user.alipay_no}}</td>
                    <td>{{withdraw.user.mobile}}</td>
                    {%if withdraw.status==1%}
                    <td>提现成功</td>
                    <td>{{ftime(withdraw.utime)}}</td>
                    {%elif withdraw.status==0%}
                    <td>提现中</td>
                    <td>{{ftime(withdraw.ctime)}}</td>
                    <td align="right">
                        <a href="" data-wid="{{withdraw.id}}" class="btn btn-primary btn-sm">批准提现</a>
                    </td>
                    {%end%}
                </tr>
                {%elif typ in [2,3]%}
                <tr>
                    <td>{{withdraw.partner.id}}</td>
                    <td>{{withdraw.partner.user_name}}</td>
                    <td>{{withdraw.amount}}</td>
                    <td>{{withdraw.partner.nick_name}}</td>
                    <td>{{withdraw.partner.mobile}}</td>
                    {%if withdraw.status==1%}
                    <td>提现成功</td>
                    <td>{{ftime(withdraw.utime)}}</td>
                    {%elif withdraw.status==0%}
                    <td>提现中</td>
                    <td>{{ftime(withdraw.ctime)}}</td>
                    <td align="right">
                        <a href="" data-wid="{{withdraw.id}}" class="btn btn-primary btn-sm">批准提现</a>
                    </td>
                    {%end%}
                </tr>
                {%end%}
                {%end%}
                </tbody>
            </table>

            {% module Template("module/bspager.html",
            pager=pager,url="/m/withdraw/list/"+str(typ)+"?pagenum=:page:")%}
        </div>
    </div>
</div>
{% end %}